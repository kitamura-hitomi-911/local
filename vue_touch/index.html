<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Vue Touch</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
<div id="touch"><vm_list category="top"></vm_list></div>


<script type="text/x-template" id="tmpl-list">
	<div class="l-list">
		<div class="l-list-inner" :style="style_obj">
			<item v-for="memo in selectedMemo" :key="memo.id" :memo="memo"></item>
			<div class="l-item l-item-more" v-if="readmore_flg">
				<div class="item-more">
					<a href="#"></a>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-template" id="tmpl-item">
	<div class="l-item">
		<div class="item">
			<a href="#">
				<dl>
					<dt>{{memo.title}}</dt>
					<dd>{{memo.lead}}</dd>
				</dl>
			</a>
		</div>
	</div>
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.2.6/css/swiper.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.2.6/js/swiper.js"></script>

<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="./hammer.min.js"></script>
<script src="./vue-touch.js"></script>
<script type="text/javascript">
	(function(){
		Vue.component('vm_list', {
			template:'#tmpl-list',
			props:{
				category:String
			},
			data: function(){
				return {
					readmore_flg:false,
					memos: [
						{id: 1, title: 'タイトル', lead: '内容部分', category: ['top']},
						{id: 2, title: 'タイトル2', lead: '内容部分2', category: ['top']},
						{id: 3, title: 'タイトル3', lead: '内容部分3', category: ['top', 'hoge']},
						{id: 4, title: 'タイトル4', lead: '内容部分4', category: ['hoge']},
						{id: 5, title: 'タイトル5', lead: '内容部分5', category: ['top']},
						{id: 6, title: 'タイトル6', lead: '内容部分6', category: ['top']},
						{id: 7, title: 'タイトル7', lead: '内容部分7内容部分7内容部分7内容部分7', category: ['top']}
					]
				}
			},
			computed: {
				style_obj:function(){
					return {
						width:(this.selectedMemo.length * 200 + (this.readmore_flg?20:0)) + 'px'
					}
				},
				selectedMemo:function(){
					var that = this;
					var ret = [];
					var max_num = 6;
					var category = this.category || '';
					this.memos.forEach(function(memo){
						if(!category || memo.category.indexOf(category) >= 0){
							if(ret.length < max_num){
								ret.push(memo);
							}else{
								that.readmore_flg = true;
							}
						}
					});
					return ret;
				}
			},
			mounted: function () {
				var mySwiper = new Swiper ('.l-list', {
					wrapperClass:'l-list-inner',
					slideClass:'l-item',
					slidesPerView: 'auto',
					freeMode: true,
					freeModeMomentumRatio:0.5,
					shortSwipes:false,
					longSwipesRatio:0.25
				});
			},
			components:{
				item:{
					props:{
						memo:Object
					},
					template:'#tmpl-item'
				}
			}
		});
		var vm_memo = new Vue({
			el:'#touch'
		});
	})();
</script>
</body>
</html>