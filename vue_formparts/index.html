<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Title</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="form-area">
	<form action="" method="get">
		<form-item :form_data="form_data.input_text_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.input_password_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.input_number_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.input_radio_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.input_radio_text_sample" @update-form-data="updateFormData">
			<form-input :form_data="form_data.input_add_text_sample" @update-form-data="updateFormData"></form-input>
		</form-item>
		<form-item :form_data="form_data.input_checkbox_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.select_sample" @update-form-data="updateFormData"></form-item>
		<form-item :form_data="form_data.textarea_sample" @update-form-data="updateFormData"></form-item>
		<p class="btn"><a href="#" @click.stop.prevent="submit">送信</a></p>
	</form>
</div>

<script type="text/x-template" id="tmpl-form-radio">
	<div class="radio_parts">
		<template v-for="radio in form_data.list" >
			<p class="radio_parts-item">
				<input :type="form_data.type" :id="form_data.name+'_'+radio.value" name="form_data.name" :value="radio.value" :disabled="radio.disabled" @input="updateValue"><label :for="form_data.name+'_'+radio.value">{{radio.label}}</label>
			</p>
		</template>
	</div>
</script>
<script type="text/x-template" id="tmpl-form-checkbox">
	<div class="checkbox_parts">
		<template v-for="checkbox in form_data.list" >
			<p class="checkbox_parts-item">
				<input :type="form_data.type" :id="form_data.name+'_'+checkbox.value" name="form_data.name" :value="checkbox.value" :disabled="checkbox.disabled" @input="updateValue"><label :for="form_data.name+'_'+checkbox.value">{{checkbox.label}}</label>
			</p>
		</template>
	</div>
</script>
<script type="text/x-template" id="tmpl-form-select">
	<div class="select_parts">
		<p class="select_parts-label">{{selected_label}}</p>
		<select :name="form_data.name" @input="updateValue" :value="form_data.value" :disabled="form_data.disabled">
			<option v-for="option in form_data.list" :key="option.value" :value="option.value">{{option.label}}</option>
		</select>
	</div>
</script>
<script type="text/x-template" id="tmpl-form-input">
	<div class="input_parts">
		<input :type="form_data.type" :value="form_data.value" :maxlength="form_data.maxlength" :minlength="form_data.minlength" :step="form_data.step" :min="form_data.min" :max="form_data.max" :placeholder="form_data.placeholder" :disabled="form_data.disabled" @input="updateValue">
	</div>
</script>
<script type="text/x-template" id="tmpl-form-textarea">
	<div class="input_textarea">
		<textarea :value="form_data.value" :placeholder="form_data.placeholder" :disabled="form_data.disabled" @input="updateValue"></textarea>
	</div>
</script>

<script type="text/x-template" id="tmpl-form-item">
	<dl class="form-item">
		<dt>{{form_data.item_name}}</dt>
		<dd>
			<component :is="component_name" :form_data="form_data" @update-form-data="updateFormData"></component>
			<slot></slot>
			<p class="form-item-err" v-if="form_data.err_msg">{{form_data.err_msg}}</p>
			<p class="form-item-note" v-if="form_data.note">{{form_data.note}}</p>
		</dd>
	</dl>
</script>

<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script type="text/javascript">
	Vue.component('form-input',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
			}
		},
		created:function(){
			// TODO:propsで渡されるデータに不足がないかチェック
		},
		methods:{
			updateValue:function(e){
				console.log('updateValue',e);

				//インスタンスのデータを更新
				this.$emit('update-form-data',{name:this.form_data.name,value:e.target.value});
			}
		},
		template:'#tmpl-form-input'
	});
	Vue.component('form-radio',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
			}
		},
		created:function(){
			// TODO:propsで渡されるデータに不足がないかチェック
		},
		methods:{
			updateValue:function(e){
				console.log('updateValue',e);

				//インスタンスのデータを更新
				this.$emit('update-form-data',{name:this.form_data.name,value:e.target.value});
			}
		},
		template:'#tmpl-form-radio'
	});
	Vue.component('form-checkbox',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
			}
		},
		created:function(){
			// TODO:propsで渡されるデータに不足がないかチェック
		},
		methods:{
			updateValue:function(e){
				console.log('updateValue',e);

				//インスタンスのデータを更新
				this.$emit('update-form-data',{name:this.form_data.name,value:e.target.value});
			}
		},
		template:'#tmpl-form-checkbox'
	});
	Vue.component('form-select',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
				selected_label:''
			}
		},
		created:function(){
			// propsからうけとる情報からのlabel初期値セット
			this._updateLabel();
		},
		methods:{
			_updateLabel:function(){
				var that = this;
				this.form_data.list.forEach(function(option){
					if(that.form_data.value === option.value){
						that.selected_label = option.label;
					}
				});
			},
			updateValue:function(e){
				console.log('updateValue',e);
				//インスタンスのデータを更新
				this.$emit('update-form-data',{name:this.form_data.name,value:e.target.value});
				// ラベルの更新
				this._updateLabel();
			}
		},
		template:'#tmpl-form-select'
	});

	Vue.component('form-textarea',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
			}
		},
		created:function(){
			// TODO:propsで渡されるデータに不足がないかチェック
		},
		methods:{
			updateValue:function(e){
				console.log('updateValue',e);

				//インスタンスのデータを更新
				this.$emit('update-form-data',{name:this.form_data.name,value:e.target.value});
			}
		},
		template:'#tmpl-form-textarea'
	});

	Vue.component('form-item',{
		props:{
			form_data:{type:Object, require: true}
		},
		data:function(){
			return {
				component_name:'form-input'
			}
		},
		created:function(){
			var component_of = {
				test:'form-input',
				password:'form-input',
				number:'form-input',
				radio:'form-radio',
				checkbox:'form-checkbox',
				select:'form-select'
			};
			this.component_name = component_of[this.form_data.type] || this.component_name;
			return;
		},
		methods:{
			updateFormData:function(obj){
				console.log('form-item の updateFormData',obj);
				//インスタンスのデータを更新
				this.$emit('update-form-data',obj);
			}
		},
		template:'#tmpl-form-item'
	});
	new Vue({
		el:'#form-area',
		data: {
			form_data:{
				input_text_sample:{
					item_name:'テキスト入力フォーム',
					name:'input_text_sample',
					type:'text',
					value:'',
					disabled:false,
					minlength:3,
					maxlength:12,
					placeholder:'入力してください',
					pattern:'^[0-9a-zA-Z_-]{3,12}$',
					pattern_err_msg:'半角英数字_-のみで3～12文字で入力',
					require: true,
					err_msg:'',
					note:'※補足テキスト'
				},
				input_password_sample:{
					item_name:'パスワード入力フォーム',
					name:'input_password_sample',
					type:'password',
					value:'',
					disabled:false,
					placeholder:'入力してください',
					require: true,
					err_msg:'',
					note:''
				},
				input_number_sample:{
					item_name:'数値入力フォーム',
					name:'input_number_sample',
					type:'number',
					step:2,
					min:4,
					value:'',
					disabled:false,
					require: true,
					err_msg:'',
					note:''
				},
				input_radio_sample:{
					item_name:'ラジオボタン',
					name:'input_radio_sample',
					type:'radio',
					value:'',
					disabled:false,
					require: true,
					err_msg:'',
					note:'',
					list:[
						{
							value:'a',
							label:'選択肢A',
							disabled:false
						},
						{
							value:'b',
							label:'選択肢B',
							disabled:false
						},
						{
							value:'c',
							label:'選択肢C',
							disabled:true
						}
					]
				},
				input_checkbox_sample:{
					item_name:'チェックボックス',
					name:'input_checkbox_sample',
					type:'checkbox',
					value:'',
					require: true,
					err_msg:'',
					note:'',
					list:[
						{
							value:'a',
							label:'選択肢A',
							disabled:false
						},
						{
							value:'b',
							label:'選択肢B',
							disabled:false
						},
						{
							value:'c',
							label:'選択肢C',
							disabled:true
						}
					]
				},
				select_sample: {
					item_name:'プルダウン',
					name:'select_sample',
					type:'select',
					value:'',
					disabled:false,
					require: true,
					err_msg:'',
					note:'',
					list: [
						{
							value: '',
							label: '↓選択してください'
						},
						{
							value: 'hoge1',
							label: 'ほげ1です'
						},
						{
							value: 'hoge2',
							label: 'ほげ2です'
						},
						{
							value: 'hoge3',
							label: 'ほげ3です'
						},
						{
							value: 'hoge4',
							label: 'ほげ4です'
						}
					]
				},
				textarea_sample:{
					item_name:'textarea',
					name:'textarea_sample',
					type:'textarea',
					value:'',
					disabled:false,
					placeholder:'入力してください',
					require: true,
					err_msg:'',
					note:'※補足テキスト'
				},
				input_radio_text_sample:{
					item_name:'ラジオボタンとテキストフォームの組み合わせ',
					name:'input_radio_text_sample',
					type:'radio',
					value:'',
					require: true,
					err_msg:'',
					note:'',
					list:[
						{
							value:'a',
							label:'こっちは選択したら以上',
							disabled:false
						},
						{
							value:'b',
							label:'テキストも入力',
							disabled:false
						}
					]
				},
				input_add_text_sample:{
					name:'input_add_text_sample',
					type:'text',
					value:'',
					disabled:true
				}
			}
		},
		computed: {
		},
		methods:{
			updateFormData:function(obj){
				console.log('親、updateFormData',obj);
				this.form_data[obj.name].value = obj.value;

				if(obj.name === 'input_radio_text_sample'){
					if(obj.value === 'b'){
						this.form_data.input_add_text_sample.disabled = false;
					}else{
						this.form_data.input_add_text_sample.disabled = true;
					}
				}

				return;
			},
			submit:function(){
				console.log('submit');
				var err_flg = false;
				for(var form_name in this.form_data){
					this.form_data[form_name].err_msg = '';
					// 未入力チェック
					if(this.form_data[form_name].require && !this.form_data[form_name].value){
						if(this.form_data[form_name].list && this.form_data[form_name].list.length){
							this.form_data[form_name].err_msg = '選択必須項目です';
						}else{
							this.form_data[form_name].err_msg = '入力必須項目です';
						}
						err_flg = true;
					}
					// フォーマットチェック
					if(!err_flg){
						if(this.form_data[form_name].pattern && this.form_data[form_name].value){
							var re = new RegExp(this.form_data[form_name].pattern);
							if(!this.form_data[form_name].value.match(re)){
								this.form_data[form_name].err_msg = this.form_data[form_name].pattern_err_msg || '入力内容を確認してください';
							}
						}
					}


					// 個別チェック
					if(form_name === 'input_add_text_sample'){
						if(this.form_data.input_radio_text_sample.value === 'b' && !this.form_data.input_add_text_sample.value){
							this.form_data.input_radio_text_sample.err_msg = 'Bを選択した場合は補足テキスト入力必須';
						}
					}
					
				}
				return false;
			}
		}
	});
</script>
</body>
</html>